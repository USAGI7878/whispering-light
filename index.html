<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Whispering Light in a Clear Winter</title>
<meta name="description" content="Whispering Light in a Clear Winter â€” a christmas envelope with warm wishes. From Peggy Â· 2025" />
<style>
  :root{
    --bg:#ffffff;
    --gold-1:rgba(212,175,55,1); /* warm gold */
    --gold-2:rgba(230,190,120,0.85);
    --muted:#f6f6f6;
    --text:#1b1b1b;
    --sub:#666;
    --envelope-red: #d4a76a; /* warm parchment color */
    --envelope-dark: #b08c5a;
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: Inter, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Noto Sans", sans-serif;
    background: linear-gradient(135deg, rgba(255,245,235,1) 0%, rgba(255,250,240,1) 50%, rgba(245,235,220,1) 100%);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    box-sizing:border-box;
    position: relative;
    overflow: hidden;
  }

  /* Full page particle canvas */
  #fullPageCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  /* Envelope Container */
  .envelope-container {
    position: relative;
    width: 100%;
    max-width: 500px;
    z-index: 2;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .envelope-container:hover {
    transform: scale(1.02);
  }

  .envelope {
    position: relative;
    width: 100%;
    height: 320px;
    background: linear-gradient(135deg, var(--envelope-red), var(--envelope-dark));
    border-radius: 12px;
    box-shadow: 
      0 20px 40px rgba(0,0,0,0.1),
      0 8px 16px rgba(0,0,0,0.05),
      inset 0 1px 0 rgba(255,255,255,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* Envelope flap */
  .envelope::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 160px;
    background: linear-gradient(135deg, var(--envelope-dark), #9c7a4d);
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    transform-origin: top;
    transition: transform 0.6s ease;
    z-index: 2;
  }

  .envelope.open::before {
    transform: rotateX(180deg);
  }

  /* Envelope seal */
  .seal {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--gold-1), var(--gold-2));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 
      0 8px 20px rgba(212,175,55,0.3),
      inset 0 2px 4px rgba(255,255,255,0.3);
    z-index: 3;
    transition: all 0.3s ease;
  }

  .seal:hover {
    transform: translate(-50%, -50%) scale(1.1);
  }

  .seal::before {
    content: 'ðŸŽ„';
    font-size: 32px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
  }

  .instruction {
    position: absolute;
    bottom: 30px;
    color: rgba(255,255,255,0.9);
    font-size: 16px;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    z-index: 3;
  }

  /* Card content (hidden initially) */
  .card-content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,250,240,0.9));
    border-radius: 12px;
    padding: 40px 30px;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    z-index: 4;
    box-shadow: inset 0 0 0 2px rgba(212,175,55,0.1);
  }

  .card-content.show {
    display: flex;
    animation: cardReveal 0.8s ease-out;
  }

  @keyframes cardReveal {
    0% {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .message{
    font-size:16px;
    color:#333;
    line-height:1.6;
    padding: 24px 32px;
    border-radius:16px;
    background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
    box-shadow: 0 8px 32px rgba(20,20,20,0.08);
    position: relative;
    max-width: 400px;
    /* Golden border effect */
    border: 1.5px solid transparent;
    background-clip: padding-box;
  }

  /* Golden border using pseudo-element */
  .message::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(135deg, var(--gold-1), var(--gold-2), var(--gold-1));
    border-radius: 18px;
    z-index: -1;
    opacity: 0.4;
    animation: goldenGlow 3s ease-in-out infinite alternate;
  }

  @keyframes goldenGlow {
    0% {
      opacity: 0.3;
    }
    100% {
      opacity: 0.6;
    }
  }

  .sign{
    margin-top:18px;
    color:var(--sub);
    font-size:13px;
    letter-spacing:0.6px;
  }

  /* Jar particle container */
  .jar-container {
    position: relative;
    width: 100%;
    max-width: 300px;
    height: 200px;
    margin: 20px 0;
    display: none;
  }

  .jar-container.show {
    display: block;
    animation: fadeIn 1s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  /* Footer */
  .foot{
    width:100%;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:18px;
    gap:12px;
  }
  .foot .meta{color:var(--sub); font-size:13px;}
  .tap{
    margin-left:auto;
    background:transparent;
    border:1px solid rgba(20,20,20,0.06);
    padding:10px 14px;
    border-radius:12px;
    font-size:14px;
    cursor:pointer;
    color:var(--text);
    box-shadow: 0 4px 12px rgba(20,20,20,0.04);
  }

  /* small responsive */
  @media (max-width:520px){
    .envelope-container { max-width: 90%; }
    .envelope { height: 280px; }
    .message{ font-size:15px; padding:18px; }
    .seal { width: 60px; height: 60px; }
    .seal::before { font-size: 24px; }
  }
</style>
</head>
<body>
  <!-- Full page particle canvas -->
  <canvas id="fullPageCanvas"></canvas>

  <!-- Envelope -->
  <div class="envelope-container" id="envelopeContainer">
    <div class="envelope" id="envelope">
      <div class="seal" id="seal"></div>
      <div class="instruction">Tap the seal to open</div>
      
      <!-- Card content (hidden initially) -->
      <div class="card-content" id="cardContent">
        <div class="message">
          <em>"Transparency is not emptiness, but a way to hold light."</em><br><br>
          Merry Christmas ðŸŽ„<br>
          Thank you for walking through the busy times and unexpected challenges together this year. Those rare moments of warmth also shine in my heart. I hope this little light can gently remind you when you need it: you deserve to be treated with kindness.<br><br>
          â€” Peggy Â· 2025
        </div>

        <!-- Jar particle effect -->
        <div class="jar-container" id="jarContainer">
          <canvas id="particleCanvas"></canvas>
        </div>

        <div class="foot">
          <div class="meta">Made with a little light & a little magic</div>
          <button class="tap" id="replayBtn" aria-label="Replay music">Play music</button>
        </div>
      </div>
    </div>
  </div>

<script>
/* ========= Full Page Particle System ========= */
const fullPageCanvas = document.getElementById('fullPageCanvas');
const fullPageCtx = fullPageCanvas.getContext('2d', { alpha: true });
let fullPageDPR = window.devicePixelRatio || 1;

function fitFullPageCanvas() {
  fullPageCanvas.width = Math.floor(window.innerWidth * fullPageDPR);
  fullPageCanvas.height = Math.floor(window.innerHeight * fullPageDPR);
  fullPageCanvas.style.width = window.innerWidth + 'px';
  fullPageCanvas.style.height = window.innerHeight + 'px';
  fullPageCtx.setTransform(fullPageDPR, 0, 0, fullPageDPR, 0, 0);
}

fitFullPageCanvas();
window.addEventListener('resize', fitFullPageCanvas);

// Full page particles
let fullPageParticles = [];
const FULL_PAGE_MAX = 150;

function createFullPageParticle() {
  return {
    x: Math.random() * window.innerWidth,
    y: Math.random() * window.innerHeight,
    vx: (Math.random() - 0.5) * 0.2,
    vy: (Math.random() - 0.5) * 0.2,
    size: Math.random() * 1.5 + 0.5,
    life: Math.random() * 10 + 5,
    age: 0,
    alpha: Math.random() * 0.3 + 0.2,
    hue: Math.random() * 10 + 38 // golden hue
  };
}

function emitFullPageBatch(count = 8) {
  for (let i = 0; i < count; i++) {
    if (fullPageParticles.length < FULL_PAGE_MAX) {
      fullPageParticles.push(createFullPageParticle());
    }
  }
}

let fullPageLast = performance.now();
function updateFullPageParticles(now) {
  const dt = (now - fullPageLast) / 1000;
  fullPageLast = now;

  // Occasional emission
  if (Math.random() < 0.2) {
    emitFullPageBatch(2);
  }

  // Update particles
  for (let i = fullPageParticles.length - 1; i >= 0; i--) {
    let p = fullPageParticles[i];
    p.age += dt;
    p.x += p.vx;
    p.y += p.vy;
    
    // Gentle floating movement
    p.vx += (Math.random() - 0.5) * 0.01;
    p.vy += (Math.random() - 0.5) * 0.01;
    
    // Limit velocity
    p.vx = Math.max(-0.3, Math.min(0.3, p.vx));
    p.vy = Math.max(-0.3, Math.min(0.3, p.vy));
    
    // Wrap around edges
    if (p.x < -10) p.x = window.innerWidth + 10;
    if (p.x > window.innerWidth + 10) p.x = -10;
    if (p.y < -10) p.y = window.innerHeight + 10;
    if (p.y > window.innerHeight + 10) p.y = -10;
    
    p.alpha *= 0.999;
    if (p.age > p.life || p.alpha < 0.05) {
      fullPageParticles.splice(i, 1);
    }
  }
}

function drawFullPageParticles() {
  const w = window.innerWidth;
  const h = window.innerHeight;
  
  // Clear with subtle fade effect for trails
  fullPageCtx.fillStyle = 'rgba(255, 250, 240, 0.03)';
  fullPageCtx.fillRect(0, 0, w, h);

  // Draw particles
  for (let p of fullPageParticles) {
    fullPageCtx.save();
    fullPageCtx.globalAlpha = p.alpha;
    fullPageCtx.fillStyle = `rgba(212, 175, 55, ${p.alpha})`;
    fullPageCtx.beginPath();
    fullPageCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    fullPageCtx.fill();
    fullPageCtx.restore();
  }
}

// Full page animation loop
let fullPageRunning = true;
function fullPageTick(now) {
  if (!fullPageRunning) return;
  updateFullPageParticles(now);
  drawFullPageParticles();
  requestAnimationFrame(fullPageTick);
}

// Start full page particles
fullPageTick(performance.now());
emitFullPageBatch(40);

/* ========= Jar Particle System ========= */
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d',{alpha:true});
let jarParticles = [];
const JAR_MAX = 80;

function fitCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.floor(rect.width * fullPageDPR);
  canvas.height = Math.floor(rect.height * fullPageDPR);
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  ctx.setTransform(fullPageDPR,0,0,fullPageDPR,0,0);
}

function createJarParticle(){
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  return {
    x: w/2 + (Math.random() - 0.5) * 60,
    y: h * 0.8,
    vx: (Math.random() - 0.5) * 0.1,
    vy: -Math.random() * 0.4 - 0.1,
    size: Math.random() * 1.5 + 0.5,
    life: Math.random() * 4 + 2,
    age: 0,
    alpha: Math.random() * 0.6 + 0.4
  };
}

function emitJarBatch(){
  if (!jarRunning) return;
  for(let i=0;i<3;i++){
    if(jarParticles.length < JAR_MAX) {
      jarParticles.push(createJarParticle());
    }
  }
}

let jarLast = performance.now();
let jarRunning = false;

function updateJarParticles(now){
  if (!jarRunning) return;
  const dt = (now - jarLast) / 1000;
  jarLast = now;

  if(Math.random() < 0.6) emitJarBatch();

  for(let i=jarParticles.length-1;i>=0;i--){
    let p = jarParticles[i];
    p.age += dt;
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.01; // gravity
    p.alpha *= 0.995;
    
    if(p.age > p.life || p.alpha < 0.05 || p.y < -10) {
      jarParticles.splice(i,1);
    }
  }
}

function drawJarParticles(){
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  ctx.clearRect(0,0,w,h);

  // Draw jar silhouette
  ctx.save();
  ctx.strokeStyle = 'rgba(212,175,55,0.15)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(w*0.3, h*0.9);
  ctx.bezierCurveTo(w*0.3, h*0.4, w*0.4, h*0.2, w*0.5, h*0.15);
  ctx.bezierCurveTo(w*0.6, h*0.2, w*0.7, h*0.4, w*0.7, h*0.9);
  ctx.stroke();
  ctx.restore();

  // Draw particles
  for(let p of jarParticles){
    ctx.save();
    ctx.globalAlpha = p.alpha;
    const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 2);
    gradient.addColorStop(0, 'rgba(255,255,255,0.8)');
    gradient.addColorStop(0.5, 'rgba(212,175,55,0.6)');
    gradient.addColorStop(1, 'rgba(212,175,55,0)');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

function jarTick(now){
  if(!jarRunning) return;
  updateJarParticles(now);
  drawJarParticles();
  requestAnimationFrame(jarTick);
}

/* ========= Christmas Music ========= */
let audioCtx = null;
let musicSource = null;
let musicGain = null;

function initMusic() {
  if (audioCtx) return;
  
  const AudioContext = window.AudioContext || window.webkitAudioContext;
  audioCtx = new AudioContext();
  musicGain = audioCtx.createGain();
  musicGain.gain.value = 0.3;
  musicGain.connect(audioCtx.destination);

  // Create a simple, gentle Christmas melody using Web Audio API
  function playNote(frequency, duration, startTime, volume = 0.1) {
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    osc.type = 'sine';
    osc.frequency.value = frequency;
    
    gainNode.gain.value = volume;
    gainNode.gain.exponentialRampToValueAtTime(0.001, startTime + duration);
    
    osc.connect(gainNode);
    gainNode.connect(musicGain);
    
    osc.start(startTime);
    osc.stop(startTime + duration);
  }

  // "Silent Night" melody notes (simplified)
  const melody = [
    { note: 392, duration: 0.6 }, // G
    { note: 349, duration: 0.6 }, // F
    { note: 330, duration: 0.6 }, // E
    { note: 392, duration: 0.6 }, // G
    { note: 392, duration: 0.6 }, // G
    { note: 349, duration: 0.6 }, // F
    { note: 330, duration: 0.6 }, // E
    { note: 294, duration: 0.6 }, // D
    { note: 392, duration: 0.6 }, // G
    { note: 392, duration: 0.6 }, // G
    { note: 440, duration: 0.6 }, // A
    { note: 392, duration: 0.6 }, // G
    { note: 349, duration: 0.6 }, // F
    { note: 330, duration: 0.6 }, // E
    { note: 349, duration: 0.6 }, // F
    { note: 392, duration: 0.6 }  // G
  ];

  function scheduleMusic() {
    const startTime = audioCtx.currentTime + 0.1;
    melody.forEach((note, index) => {
      playNote(note.note, note.duration, startTime + index * 0.7);
    });
    
    // Repeat after melody finishes
    setTimeout(scheduleMusic, melody.length * 700);
  }

  scheduleMusic();
}

function playMusic() {
  if (!audioCtx) {
    initMusic();
  } else if (audioCtx.state === 'suspended') {
    audioCtx.resume();
  }
}

/* ========= Envelope Interaction ========= */
const envelopeContainer = document.getElementById('envelopeContainer');
const envelope = document.getElementById('envelope');
const seal = document.getElementById('seal');
const cardContent = document.getElementById('cardContent');
const jarContainer = document.getElementById('jarContainer');
const replayBtn = document.getElementById('replayBtn');

let isOpened = false;

function openEnvelope() {
  if (isOpened) return;
  
  isOpened = true;
  
  // Add open class for flap animation
  envelope.classList.add('open');
  
  // Show card content after a delay
  setTimeout(() => {
    cardContent.classList.add('show');
    jarContainer.classList.add('show');
    
    // Start jar particles
    fitCanvas();
    jarRunning = true;
    jarLast = performance.now();
    jarTick(performance.now());
    
    // Start music
    playMusic();
  }, 600);
}

// Event listeners
seal.addEventListener('click', openEnvelope);
envelopeContainer.addEventListener('click', openEnvelope);
replayBtn.addEventListener('click', playMusic);

// Keyboard accessibility
envelopeContainer.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    openEnvelope();
  }
});

// Make envelope focusable for accessibility
envelopeContainer.setAttribute('tabindex', '0');

/* ========= Initialize ========= */
// Initial full page particles
emitFullPageBatch(40);

// Auto-fit canvas when jar becomes visible
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
      if (jarContainer.classList.contains('show')) {
        setTimeout(fitCanvas, 100);
      }
    }
  });
});

observer.observe(jarContainer, { attributes: true });

// Handle window resize for jar canvas
window.addEventListener('resize', () => {
  if (jarRunning) {
    fitCanvas();
  }
});
</script>
</body>
</html>
