<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Whispering Light in a Clear Winter</title>
<meta name="description" content="Whispering Light in a Clear Winter ‚Äî a christmas envelope with warm wishes. From Peggy ¬∑ 2025" />
<style>
  :root{
    /* Christmas Theme Colors */
    --gold: #c4a86f;
    --deep-red: #8b0000;
    --burgundy: #722f37;
    --cream: #f5f1e6;
    --dark-blue: #021E47;
    --light-gold: #e6d7b8;
  }
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  html,body{height:100%;}
  body{
    margin:0;
    font-family: "Playfair Display", "Times New Roman", serif;
    background: var(--dark-blue);
    color: var(--cream);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    box-sizing:border-box;
    position: relative;
    overflow: hidden;
  }

  /* Full page particle canvas */
  #fullPageCanvas {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  /* Envelope Container */
  .envelope-container {
    position: relative;
    width: 100%;
    max-width: 800px;
    z-index: 2;
    cursor: pointer;
    transition: transform 0.3s ease;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto;
  }

  .envelope-container:hover {
    transform: scale(1.02);
  }

  .envelope {
    position: relative;
    width: 100%;
    height: 560px;
    background: linear-gradient(135deg, var(--cream), #f0eade);
    border-radius: 12px;
    box-shadow: 
      0 30px 60px rgba(0,0,0,0.3),
      0 15px 30px rgba(0,0,0,0.2),
      inset 0 1px 0 rgba(255,255,255,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 2px solid var(--gold);
  }

  /* Envelope flap */
  .envelope::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 280px;
    background: linear-gradient(135deg, #f0eade, #e8dfcc);
    clip-path: polygon(0 0, 100% 0, 50% 100%);
    transform-origin: top;
    transition: transform 0.8s ease;
    z-index: 2;
    border-bottom: 2px solid var(--gold);
  }

  .envelope.open::before {
    transform: rotateX(180deg);
  }

  /* Envelope seal */
  .seal {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 120px;
    height: 120px;
    background: radial-gradient(circle, var(--gold), #b08d5a);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 
      0 15px 40px rgba(196, 168, 111, 0.6),
      inset 0 3px 6px rgba(255,255,255,0.2);
    z-index: 3;
    transition: all 0.4s ease;
    animation: sealGlow 3s ease-in-out infinite alternate;
    border: 3px solid var(--light-gold);
    margin: 0 !important;
    padding: 0;
  }

  @keyframes sealGlow {
    0% {
      box-shadow: 0 12px 35px rgba(196, 168, 111, 0.5);
    }
    100% {
      box-shadow: 0 18px 45px rgba(196, 168, 111, 0.9);
    }
  }

  .seal:hover {
    transform: translate(-50%, -50%) scale(1.08);
  }

  .seal::before {
    content: '‚ú¶';
    font-size: 48px;
    color: var(--cream);
    font-weight: 300;
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
  }

  .instruction {
    position: absolute;
    bottom: 50px;
    color: #8a7866;
    font-size: 18px;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    z-index: 3;
    font-weight: 300;
    letter-spacing: 1.5px;
    font-family: "Playfair Display", serif;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
  }

  /* Card content (hidden initially) */
  .card-content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, var(--cream), #f0eade);
    border-radius: 12px;
    padding: 40px 50px;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    text-align: center;
    z-index: 4;
    overflow-y: auto;
  }

  .card-content.show {
    display: flex;
    animation: cardReveal 1s ease-out;
  }

  @keyframes cardReveal {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.96);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .message{
    font-size: 18px;
    color: #5c4b37;
    line-height: 1.8;
    padding: 40px 45px;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(250,247,240,0.9));
    box-shadow: 0 20px 50px rgba(0,0,0,0.2);
    position: relative;
    max-width: 600px;
    border: 4px solid transparent;
    background-clip: padding-box;
    margin-top: 50px;
    font-family: "Playfair Display", serif;
    transform: translateY(25px);
  }

  /* Golden border */
  .message::before {
    content: '';
    position: absolute;
    top: -5px;
    left: -5px;
    right: -5px;
    bottom: -5px;
    background: linear-gradient(135deg, var(--gold), var(--light-gold), #d4b98a, var(--gold));
    border-radius: 12px;
    z-index: -1;
    opacity: 0.9;
    animation: goldenGlow 2.5s ease-in-out infinite alternate;
  }

  @keyframes goldenGlow {
    0% {
      opacity: 0.8;
      filter: drop-shadow(0 5px 20px rgba(196, 168, 111, 0.4));
    }
    100% {
      opacity: 1;
      filter: drop-shadow(0 8px 30px rgba(196, 168, 111, 0.6));
    }
  }

  .message em {
    color: var(--burgundy);
    font-style: italic;
    font-weight: 500;
    font-size: 20px;
  }

  .sign{
    margin-top: 30px;
    color: #8a7866;
    font-size: 14px;
    letter-spacing: 2px;
    font-family: "Playfair Display", serif;
    font-weight: 300;
  }

  /* Jar particle container */
  .jar-container {
    position: relative;
    width: 100%;
    max-width: 400px;
    height: 250px;
    margin: 30px 0 20px 0;
    display: none;
  }

  .jar-container.show {
    display: block;
    animation: fadeIn 1.2s ease-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(15px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Footer - Centered music button */
  .foot{
    width:100%;
    display:flex;
    justify-content: center;
    align-items:center;
    margin-top: 25px;
    gap:15px;
    margin-bottom: 25px;
  }

  .music-button{
    background: linear-gradient(135deg, var(--gold), #b08d5a);
    border: none;
    padding: 15px 30px;
    border-radius: 12px;
    font-size:16px;
    cursor:pointer;
    color: var(--cream);
    box-shadow: 0 6px 25px rgba(196, 168, 111, 0.5);
    transition: all 0.3s ease;
    font-family: "Playfair Display", serif;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 8px;
    min-width: 160px;
    justify-content: center;
  }

  .music-button:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(196, 168, 111, 0.7);
  }

  .music-button.playing {
    background: linear-gradient(135deg, #8b0000, var(--burgundy));
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  /* Ê°åÈù¢Á´ØÁâπÂÆö‰øÆÂ§ç */
  @media (min-width: 769px) {
    .seal {
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      margin-left: 0 !important;
    }
    
    .envelope-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }
  }

  /* ÁßªÂä®Á´ØÂìçÂ∫îÂºèËÆæËÆ° */
  @media (max-width: 768px){
    .envelope-container { 
      max-width: 95%; 
      padding: 10px;
    }
    .envelope { 
      height: 500px; 
    }
    .card-content {
      padding: 30px 35px;
    }
    .message{ 
      font-size:16px; 
      padding: 35px 40px;
      margin-top: 40px;
      transform: translateY(20px);
      max-width: 500px;
    }
    .seal { 
      width: 100px; 
      height: 100px; 
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
    }
    .seal::before { 
      font-size: 40px; 
    }
    .jar-container {
      max-width: 350px;
      height: 220px;
    }
    .instruction {
      font-size: 16px;
      bottom: 40px;
    }
    .music-button {
      padding: 12px 25px;
      font-size: 14px;
      min-width: 140px;
    }
  }

  /* Ë∂ÖÂ∞èÂ±èÂπïËÆæÂ§á */
  @media (max-width: 480px){
    .envelope { 
      height: 450px; 
    }
    .card-content {
      padding: 20px 25px;
    }
    .message{ 
      font-size:15px; 
      padding: 30px 35px;
      margin-top: 30px;
      transform: translateY(15px);
      max-width: 400px;
    }
    .seal { 
      width: 90px; 
      height: 90px; 
    }
    .seal::before { 
      font-size: 36px; 
    }
    .jar-container {
      max-width: 300px;
      height: 200px;
    }
    .instruction {
      font-size: 14px;
      bottom: 35px;
    }
  }

  /* ÈíàÂØπÂæÆ‰ø°ÊµèËßàÂô®‰ºòÂåñ */
  @supports (-webkit-touch-callout: none) {
    .seal {
      -webkit-transform: translate(-50%, -50%) !important;
      transform: translate(-50%, -50%) !important;
    }
  }
</style>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Full page particle canvas -->
  <canvas id="fullPageCanvas"></canvas>

  <!-- Envelope -->
  <div class="envelope-container" id="envelopeContainer">
    <div class="envelope" id="envelope">
      <div class="seal" id="seal"></div>
      <div class="instruction">CLICK TO OPEN</div>
      
      <!-- Card content (hidden initially) -->
      <div class="card-content" id="cardContent">
        <div class="message">
          <em>"Transparency is not emptiness, but a way to hold light."</em><br><br>
          Merry Christmas üéÑ<br>
          Thank you for walking through the busy times and unexpected challenges together this year. Those rare moments of warmth also shine in my heart. I hope this little light can gently remind you when you need it: you deserve to be treated with kindness.<br><br>
          ‚Äî Peggy ¬∑ 2025
        </div>

        <!-- Jar particle effect -->
        <div class="jar-container" id="jarContainer">
          <canvas id="particleCanvas"></canvas>
        </div>

        <div class="foot">
          <button class="music-button" id="musicBtn">
            <span class="music-icon">üéµ</span>
            <span class="music-text">Play Music</span>
          </button>
        </div>
      </div>
    </div>
  </div>

<script>
// JavaScript ‰ª£Á†Å‰øùÊåÅ‰∏çÂèò
/* ========= Full Page Snow System ========= */
const fullPageCanvas = document.getElementById('fullPageCanvas');
const fullPageCtx = fullPageCanvas.getContext('2d', { alpha: true });
let fullPageDPR = window.devicePixelRatio || 1;

function fitFullPageCanvas() {
  fullPageCanvas.width = Math.floor(window.innerWidth * fullPageDPR);
  fullPageCanvas.height = Math.floor(window.innerHeight * fullPageDPR);
  fullPageCanvas.style.width = window.innerWidth + 'px';
  fullPageCanvas.style.height = window.innerHeight + 'px';
  fullPageCtx.setTransform(fullPageDPR, 0, 0, fullPageDPR, 0, 0);
}

fitFullPageCanvas();
window.addEventListener('resize', fitFullPageCanvas);

let snowflakes = [];
const SNOWFLAKE_COUNT = 120;

function createSnowflake() {
  const size = Math.random() * 3 + 1.5;
  return {
    x: Math.random() * window.innerWidth,
    y: Math.random() * -window.innerHeight,
    vx: (Math.random() - 0.5) * 0.1,
    vy: Math.random() * 0.3 + 0.1,
    size: size,
    swing: Math.random() * Math.PI * 2,
    swingSpeed: Math.random() * 0.005 + 0.002,
    life: Math.random() * 30 + 20,
    age: 0,
    alpha: Math.random() * 0.6 + 0.3,
    wobble: Math.random() * 0.3 + 0.2
  };
}

function emitSnowflakeBatch(count = 5) {
  for (let i = 0; i < count; i++) {
    if (snowflakes.length < SNOWFLAKE_COUNT) {
      snowflakes.push(createSnowflake());
    }
  }
}

let snowLast = performance.now();
function updateSnowflakes(now) {
  const dt = (now - snowLast) / 1000;
  snowLast = now;

  if (Math.random() < 0.1) {
    emitSnowflakeBatch(2);
  }

  for (let i = snowflakes.length - 1; i >= 0; i--) {
    let snowflake = snowflakes[i];
    snowflake.age += dt;
    
    snowflake.swing += snowflake.swingSpeed;
    snowflake.x += snowflake.vx + Math.sin(snowflake.swing) * snowflake.wobble * 0.1;
    snowflake.y += snowflake.vy;
    
    if (snowflake.y > window.innerHeight + 10) {
      snowflake.y = -10;
      snowflake.x = Math.random() * window.innerWidth;
    }
    if (snowflake.x < -20) snowflake.x = window.innerWidth + 20;
    if (snowflake.x > window.innerWidth + 20) snowflake.x = -20;
    
    if (snowflake.age > snowflake.life) {
      snowflakes.splice(i, 1);
    }
  }
}

function drawSnowflakes() {
  const w = window.innerWidth;
  const h = window.innerHeight;
  
  fullPageCtx.fillStyle = 'rgba(2, 30, 71, 0.05)';
  fullPageCtx.fillRect(0, 0, w, h);

  for (let snowflake of snowflakes) {
    fullPageCtx.save();
    fullPageCtx.globalAlpha = snowflake.alpha;
    fullPageCtx.fillStyle = 'rgba(255, 255, 255, 0.8)';
    
    fullPageCtx.beginPath();
    fullPageCtx.arc(snowflake.x, snowflake.y, snowflake.size, 0, Math.PI * 2);
    fullPageCtx.fill();
    
    fullPageCtx.restore();
  }
}

let snowRunning = true;
function snowTick(now) {
  if (!snowRunning) return;
  updateSnowflakes(now);
  drawSnowflakes();
  requestAnimationFrame(snowTick);
}

snowTick(performance.now());
emitSnowflakeBatch(SNOWFLAKE_COUNT);

/* ========= Jar Particle System ========= */
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d',{alpha:true});
let jarParticles = [];
const JAR_MAX = 60;

function fitCanvas(){
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.floor(rect.width * fullPageDPR);
  canvas.height = Math.floor(rect.height * fullPageDPR);
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  ctx.setTransform(fullPageDPR,0,0,fullPageDPR,0,0);
}

function createJarParticle(){
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  return {
    x: w/2 + (Math.random() - 0.5) * 60,
    y: h * 0.8,
    vx: (Math.random() - 0.5) * 0.05,
    vy: -Math.random() * 0.2 - 0.03,
    size: Math.random() * 2 + 1,
    life: Math.random() * 6 + 4,
    age: 0,
    alpha: Math.random() * 0.6 + 0.4
  };
}

function emitJarBatch(){
  if (!jarRunning) return;
  for(let i=0;i<2;i++){
    if(jarParticles.length < JAR_MAX) {
      jarParticles.push(createJarParticle());
    }
  }
}

let jarLast = performance.now();
let jarRunning = false;

function updateJarParticles(now){
  if (!jarRunning) return;
  const dt = (now - jarLast) / 1000;
  jarLast = now;

  if(Math.random() < 0.4) emitJarBatch();

  for(let i=jarParticles.length-1;i>=0;i--){
    let p = jarParticles[i];
    p.age += dt;
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.005;
    p.alpha *= 0.997;
    
    if(p.age > p.life || p.alpha < 0.05 || p.y < -10) {
      jarParticles.splice(i,1);
    }
  }
}

function drawJarParticles(){
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  ctx.clearRect(0,0,w,h);

  ctx.save();
  ctx.strokeStyle = 'rgba(196, 168, 111, 0.2)';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(w*0.3, h*0.9);
  ctx.bezierCurveTo(w*0.3, h*0.4, w*0.4, h*0.2, w*0.5, h*0.15);
  ctx.bezierCurveTo(w*0.6, h*0.2, w*0.7, h*0.4, w*0.7, h*0.9);
  ctx.stroke();
  ctx.restore();

  for(let p of jarParticles){
    ctx.save();
    ctx.globalAlpha = p.alpha;
    const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 2);
    gradient.addColorStop(0, 'rgba(255,255,255,0.9)');
    gradient.addColorStop(0.4, 'rgba(196, 168, 111, 0.7)');
    gradient.addColorStop(1, 'rgba(196, 168, 111, 0)');
    ctx.fillStyle = gradient;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
    ctx.fill();
    ctx.restore();
  }
}

function jarTick(now){
  if(!jarRunning) return;
  updateJarParticles(now);
  drawJarParticles();
  requestAnimationFrame(jarTick);
}

/* ========= LOFI CHRISTMAS MUSIC SYSTEM ========= */
let audioContext = null;
let isPlaying = false;
let musicNodes = [];

function createLofiChristmasMusic() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }

  // Clear previous nodes
  musicNodes.forEach(node => {
    if (node.stop) node.stop();
    if (node.disconnect) node.disconnect();
  });
  musicNodes = [];

  // Create main gain node
  const masterGain = audioContext.createGain();
  masterGain.gain.value = 0.4;
  masterGain.connect(audioContext.destination);
  musicNodes.push(masterGain);

  // Lofi drum beat
  function createKick(time) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(masterGain);
    
    oscillator.frequency.setValueAtTime(150, time);
    oscillator.frequency.exponentialRampToValueAtTime(0.001, time + 0.5);
    
    gainNode.gain.setValueAtTime(0.6, time);
    gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.5);
    
    oscillator.start(time);
    oscillator.stop(time + 0.5);
    musicNodes.push(oscillator, gainNode);
  }

  // Lofi hi-hat
  function createHiHat(time) {
    const bufferSize = audioContext.sampleRate * 0.02;
    const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < bufferSize; i++) {
      data[i] = Math.random() * 2 - 1;
    }
    
    const source = audioContext.createBufferSource();
    const gainNode = audioContext.createGain();
    const filter = audioContext.createBiquadFilter();
    
    source.buffer = buffer;
    filter.type = 'highpass';
    filter.frequency.value = 7000;
    
    source.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(masterGain);
    
    gainNode.gain.setValueAtTime(0.1, time);
    gainNode.gain.exponentialRampToValueAtTime(0.001, time + 0.1);
    
    source.start(time);
    source.stop(time + 0.1);
    musicNodes.push(source, gainNode, filter);
  }

  // Soft bell melody (Christmas vibe)
  function createBell(note, time, duration) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    const filter = audioContext.createBiquadFilter();
    
    oscillator.connect(filter);
    filter.connect(gainNode);
    gainNode.connect(masterGain);
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(note, time);
    
    filter.type = 'lowpass';
    filter.frequency.value = 2000;
    
    gainNode.gain.setValueAtTime(0.3, time);
    gainNode.gain.exponentialRampToValueAtTime(0.001, time + duration);
    
    oscillator.start(time);
    oscillator.stop(time + duration);
    musicNodes.push(oscillator, gainNode, filter);
  }

  // Christmas melody notes (simplified Jingle Bells in lofi style)
  const melody = [
    523.25, 523.25, 523.25, 392, 392, 440, 440, 493.88,
    523.25, 523.25, 523.25, 392, 392, 440, 440, 493.88
  ];

  // Start the music
  const startTime = audioContext.currentTime + 0.1;
  
  // Drum loop
  for (let i = 0; i < 32; i++) {
    const time = startTime + i * 0.5;
    createKick(time);
    createHiHat(time + 0.25);
  }

  // Bell melody
  melody.forEach((note, index) => {
    createBell(note, startTime + index * 1, 0.8);
  });

  // Loop the music
  setTimeout(() => {
    if (isPlaying) {
      createLofiChristmasMusic();
    }
  }, 16000); // 16 second loop

  return true;
}

function toggleMusic() {
  const musicBtn = document.getElementById('musicBtn');
  const musicText = musicBtn.querySelector('.music-text');
  const musicIcon = musicBtn.querySelector('.music-icon');

  if (!isPlaying) {
    // Start music
    if (!audioContext) {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    if (audioContext.state === 'suspended') {
      audioContext.resume();
    }
    
    createLofiChristmasMusic();
    isPlaying = true;
    
    musicBtn.classList.add('playing');
    musicText.textContent = 'Playing...';
    musicIcon.textContent = 'üé∂';
    
    console.log('Lofi Christmas music started');
  } else {
    // Stop music
    musicNodes.forEach(node => {
      if (node.stop) node.stop();
      if (node.disconnect) node.disconnect();
    });
    musicNodes = [];
    isPlaying = false;
    
    musicBtn.classList.remove('playing');
    musicText.textContent = 'Play Music';
    musicIcon.textContent = 'üéµ';
    
    console.log('Music stopped');
  }
}

/* ========= Envelope Interaction ========= */
const envelopeContainer = document.getElementById('envelopeContainer');
const envelope = document.getElementById('envelope');
const seal = document.getElementById('seal');
const cardContent = document.getElementById('cardContent');
const jarContainer = document.getElementById('jarContainer');
const musicBtn = document.getElementById('musicBtn');

let isOpened = false;

function openEnvelope() {
  if (isOpened) return;
  
  isOpened = true;
  console.log('Opening envelope...');
  
  envelope.classList.add('open');
  
  setTimeout(() => {
    cardContent.classList.add('show');
    jarContainer.classList.add('show');
    
    fitCanvas();
    jarRunning = true;
    jarLast = performance.now();
    jarTick(performance.now());
  }, 800);
}

// Event listeners
seal.addEventListener('click', openEnvelope);
envelopeContainer.addEventListener('click', openEnvelope);
musicBtn.addEventListener('click', function(e) {
  e.stopPropagation();
  toggleMusic();
});

// Keyboard accessibility
envelopeContainer.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    openEnvelope();
  }
});

// Make envelope focusable
envelopeContainer.setAttribute('tabindex', '0');

/* ========= Initialize ========= */
emitSnowflakeBatch(SNOWFLAKE_COUNT);

const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
      if (jarContainer.classList.contains('show')) {
        setTimeout(fitCanvas, 100);
      }
    }
  });
});

observer.observe(jarContainer, { attributes: true });

window.addEventListener('resize', () => {
  if (jarRunning) {
    fitCanvas();
  }
});

// Initialize audio context on first user interaction
document.addEventListener('click', function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
    console.log('Audio context initialized');
  }
}, { once: true });

console.log('Christmas card loaded - Click envelope to open, then click music button for lofi beats!');
</script>
</body>
</html>
